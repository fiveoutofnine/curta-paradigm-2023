<img align="right" width="150" height="150" top="100" src="./assets/curta-pepe-150x150.webp">

## Curta ^ Paradigm CTF 2023 Player NFTs

> An NFT collection to commemorate players of the Curta team for their participation and performance in the 2023 Paradigm CTF. In addition to displaying the team's results, the metadata of each token contains a 100% onchain-generated 1:38 minute long audio arrangement of "In the Hall of the Mountain King" by Edvard Grieg with 3 layered melody lines and a bass line at 117.1875 BPM.

https://github.com/fiveoutofnine/curta-paradigm-2023/assets/66016924/209b11ab-2df6-48a8-9c5c-fdb5deaef00b

## Deployment

[`CurtaPCTF2023`](https://github.com/fiveoutofnine/curta-paradigm-2023/blob/add-deploy/src/CurtaPCTF2023.sol) was deployed on Ethereum at [`0x6F2Df6c95D80e359a25b6a549037F3B70879B343`](https://etherscan.io/address/0x6F2Df6c95D80e359a25b6a549037F3B70879B343) compiled with `1_000_000` optimization runs and `solc` version `0.8.21+commit.d9974bed`.

## Local development

This project uses [**Foundry**](https://github.com/foundry-rs/foundry) as its development/testing framework.

### Installation

First, make sure you have Foundry installed. Then, run the following commands to clone the repo and install its dependencies:

```sh
git clone https://github.com/fiveoutofnine/curta-paradigm-2023.git
cd curta-paradigm-2023
forge install
```

### Sample metadata art/audio generation

To test the metadata art output, follow the instructions in [`PrintCurtaPCTF2023ArtScript`](https://github.com/fiveoutofnine/curta-paradigm-2023/blob/main/script/PrintCurtaPCTF2023Art.s.sol) and run the following command:

```
forge script script/PrintCurtaPCTF2023Art.s.sol:PrintCurtaPCTF2023ArtScript -vvv
```

To test the metadata audio output, follow the instructions in [`PrintCurtaPCTF2023AudioScript`](https://github.com/fiveoutofnine/curta-paradigm-2023/blob/main/script/PrintCurtaPCTF2023Audio.s.sol) and run the following command:

```
forge script script/PrintCurtaPCTF2023Audio.s.sol:PrintCurtaPCTF2023AudioScript -vvv
```

### Deploying

1. Configure the `OWNER` variable inside [`print-bytecode.sh`](https://github.com/fiveoutofnine/curta-paradigm-2023/blob/main/print-bytecode.sh), which will write the bytecode with constructor arguments to `bytecode-with-constructor.txt`.

2. [Optional] Compute a `create2` salt to deploy with. Here's some basic steps to do that with [**flood-protocol/maldon**](https://github.com/flood-protocol/maldon):

```sh
git clone https://github.com/flood-protocol/maldon.git
cd maldon
cargo install --path .
maldon --pattern $PATTERN $CREATE2_FACTORY_ADDRESS $CALLER $INIT_CODE_HASH
```

3. Use a factory (e.g. [`0x0000000000FFe8B47B3e2130213B802212439497`](https://etherscan.io/address/0x0000000000ffe8b47b3e2130213b802212439497)) to deploy the bytecode to a deterministic address or just deploy the generated bytecode.

### Verifying `CurtaPCTF2023`

To compute the constructor arguments, you can copy paste the last 64 characters from `bytecode-with-constructor.txt` (remember to run `print-bytecode.sh` with the correct constructor arguments set first) or run the following command:

```sh
cast abi-encode "constructor(address)" $OWNER
```

Then, to verify the contract on [**Etherscan**](https://etherscan.io), run the following command:

```sh
forge verify-contract --chain-id $CHAIN_ID --num-of-optimizations $NUM_OF_OPTIMIZATIONS --watch --compiler-version $COMPILER_VERSION $DEPLOY_ADDRESS src/CurtaPCTF2023.sol:CurtaPCTF2023 --constructor-args $CONSTRUCTOR_ARGS  --etherscan-api-key $ETHERSCAN_API_KEY --verifier "etherscan" --verifier-url "https://api.etherscan.io/api"
```

For example, [`0x6F2Df6c95D80e359a25b6a549037F3B70879B343`](https://etherscan.io/address/0x6F2Df6c95D80e359a25b6a549037F3B70879B343) was verified by running the following command:

```sh
forge verify-contract --chain-id 1 --num-of-optimizations 1000000 --watch --compiler-version "0.8.21+commit.d9974bed" "0x6F2Df6c95D80e359a25b6a549037F3B70879B343" src/CurtaPCTF2023.sol:CurtaPCTF2023 --constructor-args "0x0000000000000000000000005dd2083a0d68c4eb8fed93ef010d1b0d68b3880f" --etherscan-api-key $ETHERSCAN_API_KEY --verifier "etherscan" --verifier-url "https://api.etherscan.io/api"
```
